modules = ["python-3.12", "web"]

# Use environment mode from Secrets
run = "FLASK_ENV=production python main.py"

[nix]
channel = "stable-24_05"

[env]
PYTHONPATH = "${PYTHONPATH}:${REPL_HOME}"
PORT = "5001"  # Match your Flask port
FLASK_ENV = "production"

[deployment]
run = ["sh", "-c", "FLASK_ENV=production python main.py"]
deploymentTarget = "cloudrun"

# Enable python packages to be installed
[packager]
language = "python3"
ignoredPackages = ["unit_tests"]

[packager.features]
enabledForHosting = true
packageSearch = true
guessImports = true

[[ports]]
localPort = 5001
externalPort = 3000 